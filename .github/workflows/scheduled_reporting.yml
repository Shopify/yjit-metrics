name: Run Scheduled Reporting

on:
  # Run daily prior to typical North America workday US Eastern Time,
  # (after the benchmarks have completed).
  # (Use any minute other than "on the hour".)
  schedule:
    - cron: "40 10 * * *" # UTC

  # Also allow running on demand via the "Run workflow" UI in GitHub Actions.
  workflow_dispatch: {}

concurrency: 1

permissions: {} # none

jobs:
  reporting:
    uses: ./.github/workflows/wrapper.yml
    secrets: inherit
    with:
      script: |
        # If any benchmarking instances are running long, stop them, and fail.
        # If they had all finished on time, proceed with the reports.
        ./bin/run quash && ./bin/run report --ref="${{ github.ref_name }}"
